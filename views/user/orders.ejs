<%-include('../partials/user_header')%>
<style>
  /* CSS for the modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
  }

  .modal-content {
    background-color: #fefefe;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  /* Additional styling */
  .form-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>

<style>
  .cardcontainer {
    height: 300px;
    overflow-y: scroll;
  }

  .card {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 10px;
  }

  .card button {
    margin-top: 10px;
  }
  .cardcontainer::-webkit-scrollbar {
  width: 8px; /* Set the width of the scrollbar */
}

.cardcontainer::-webkit-scrollbar-track {
  background-color: white; /* Set the background color of the track */
}

.cardcontainer::-webkit-scrollbar-thumb {
  background-color: white; /* Set the color of the scrollbar */
}
</style>
<!-- table style -->

<style>
  .table {
    width: 100%;
    border-collapse: collapse;
  }

  .table th,
  .table td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #ccc;
  }

  .table th {
    background-color: #f2f2f2;
  }

  .table td.image {
    width: 100px;
    height: 100px;
  }

  .table td.image img {
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
  }

  .table .product-name {
    font-size: 18px;
    font-weight: bold;
  }

  .table .product-price {
    font-weight: bold;
  }

  .table .product-subtotal {
    font-weight: bold;
    text-align: right;
  }

  .table .font-xl {
    font-size: 24px;
  }

  .table .text-brand {
    color: #007bff;
  }

  .table .fw-900 {
    font-weight: 900;
  }
</style>
      

<!-- topbar -->
<div class="container-fluid" style="background-color: rgb(255, 255, 255); height: 100px;">
  <div class="row mt-1">
      <h4 class="content-title card-title mt-3" style="color: #00000098; text-align: center;">ORDER DETAILS</h4>
      <hr>
  </div>
</div>
  <!-- /topbar -->
<section>
 
    <div class="row">
    <div class="col-md-6 mt-4">
        <div class="mb-25">
            <h4 class="text-center">Status</h4>
            <hr>
        </div>
<!-- card start -->
  
<div class="cardcontainer">
  <div class="card">
    <% if (orders[0].orderstatus == 'return') { %>
      <% if (orders[0].returnstatus == null) { %>
        <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Return</div>
      <% } else { %>
        <div class="btn" style="pointer-events: none;">Return</div>
      <% } %>
        <div class="col-12 d-grid justify-content-center mt-1 mb-1" style="background-color: #f2f2f2;"><img style="width: 30px;" src="/images/user/buttons/down-arrow.png" alt="down-arrow"></div>
        <% if (orders[0].returnstatus == 'approved') { %>
          <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Return approved</div>
        <% } else { %>
          <div class="btn" style="pointer-events: none;">Return approved</div>
        <% } %>
        <div class="col-12 d-grid justify-content-center mt-1 mb-1" style="background-color: #f2f2f2;"><img style="width: 30px;" src="/images/user/buttons/down-arrow.png" alt="down-arrow"></div>
        <% if (orders[0].returnstatus == 'packed') { %>
          <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Order picked</div>
        <% } else { %>
          <div class="btn" style="pointer-events: none;">Order picked</div>
        <% } %>
        <div class="col-12 d-grid justify-content-center mt-1 mb-1" style="background-color: #f2f2f2;"><img style="width: 30px;" src="/images/user/buttons/down-arrow.png" alt="down-arrow"></div>
        <% if (orders[0].returnstatus == 'refund') { %>
          <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Refunded</div>
        <% } else { %>
          <div class="btn" style="pointer-events: none;">Refunded</div>
        <% } %>
    <% } else {  %>
    <% if (orders[0].orderstatus == 'placed') { %>
      <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Ordered</div>
    <% } else { %>
      <div class="btn" style="pointer-events: none;">Ordered</div>
    <% } %>
    
      <div class="col-12 d-grid justify-content-center mt-1 mb-1" style="background-color: #f2f2f2;"><img style="width: 30px;" src="/images/user/buttons/down-arrow.png" alt="down-arrow"></div>
      <% if (orders[0].orderstatus == 'packed') { %>
        <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Packed</div>
      <% } else { %>
        <div class="btn" style="pointer-events: none;">Packed</div>
      <% } %>
      <div class="col-12 d-grid justify-content-center mt-1 mb-1" style="background-color: #f2f2f2;"><img style="width: 30px;" src="/images/user/buttons/down-arrow.png" alt="down-arrow"></div>
      <% if (orders[0].orderstatus == 'shipped') { %>
        <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Shipped</div>
      <% } else { %>
        <div class="btn" style="pointer-events: none;">Shipped</div>
      <% } %>
      <div class="col-12 d-grid justify-content-center mt-1 mb-1" style="background-color: #f2f2f2;"><img style="width: 30px;" src="/images/user/buttons/down-arrow.png" alt="down-arrow"></div>
      <% if (orders[0].orderstatus == 'delivered') { %>
        <div class="btn" style="pointer-events: none; background-color: #03f871a8;">Delivered</div>
      <% } else { %>
        <div class="btn" style="pointer-events: none;">Delivered</div>
      <% } %>
      <% }%>
  </div>
</div>
<% if (orders[0].orderstatus == 'canceled') { %>
  <button style="pointer-events: none;" class="btn btn-fill-out col-md-12 mb-4 mt-40"> <h4 style="color: rgb(252, 59, 59);">Your order is canceled it will remove soon as possible</h4></button>
<% } else if(orders[0].orderstatus == 'delivered') { %>
  <button style="pointer-events: none;" class="btn btn-fill-out col-md-12 mb-4 mt-40"> <h4 style="color: rgb(61, 61, 61);">Your order is delivered.</h4></button>
  <% } else if(orders[0].orderstatus == 'return') { %>
    <% if (orders[0].returnstatus == 'rejected') { %>
      <button style="pointer-events: none;" class="btn btn-fill-out col-md-12 mb-4 mt-40"> <h4 style="color: rgb(61, 61, 61);">Sorry, your order can not be returnable.</h4></button>
    <% } else { %>
      <button style="pointer-events: none;" class="btn btn-fill-out col-md-12 mb-4 mt-40"> <h4 style="color: rgb(61, 61, 61);">Your order is returning.</h4></button>
    <% } %>
  <% } else { %>
  <button style="pointer-events: none;" class="btn btn-fill-out col-md-12 mb-4 mt-40"> <h4 style="color: rgb(61, 61, 61);">Your order will be delivered as soon as possible.</h4></button>
<% } %>

<!-- card end -->
    </div>
    <div class="col-md-6 mt-4">
        <div class="order_review">
            <div class="mb-20">
                <h4 class="text-center">Your Orders</h4>
                <hr>
            </div>
            <div class="table-responsive order_table text-center">
              <div class="cardcontainer">
                <div class="card">
                  <table class="table">
                  
                    <tbody>
                      <% orders?.forEach(function(products){ %>
                        <% products.products?.forEach(function(viewProducts){ %>
                        <tr>
                          <td class="image product-thumbnail">
                            <img style="height: 80px;" class="d" src="/uploads/products/<%= viewProducts.image[0]%>" alt="product image">
                          </td>
                          <td style="vertical-align: middle;">
                            <p class="product-name"> <b><%= viewProducts.productName %></b> </p>
                          </td>
                          <td style="vertical-align: middle;" class="product-price">Rs <%= viewProducts.price %></td>
                        </tr>
                        <% })%>
                      <tr>
                        <th>SubTotal</th>
                        <td class="product-subtotal" colspan="2">Rs <%= products.total %></td>
                      </tr>
                      <tr>
                        <th>Shipping</th>
                        <td colspan="2"><em>Free Shipping</em></td>
                      </tr>
                      <tr>
                        <th>Total</th>
                        <td colspan="2" class="product-subtotal">
                          <span class="font-xl text-brand fw-900"><h4>Rs <%= products.total %></h4></span>
                        </td>
                      </tr>
                      <% })%>

                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="bt-1 border-color-1 "></div>
          
        </div>
        <button id="addAddressButton" onclick="openModal()" class="btn btn-fill-out col-md-12 mb-1">VIEW DELIVERY ADDRESS</button>
        <% if (orders[0].orderstatus == 'delivered') { %>
          <a href="/return_order/<%= orders[0]._id %>" id="returnOrderBtn">
            <button class="btn btn-fill-out col-md-12 mb-4"> 
              <h4 style="color: red;">RETURN ORDERED</h4>
            </button></a> 
        <% } else if (orders[0].orderstatus == 'return') { %>
          <button class="btn btn-fill-out col-md-12 mb-4" disabled> 
            <% if (orders[0].returnstatus) { %>
              <h4 style="color: red;text-transform: uppercase;">RETURN STATUS : <%= orders[0].returnstatus %></h4>
            <% } else { %>
              <h4 style="color: red;text-transform: uppercase;">RETURN STATUS : return</h4>
            <% } %>
          </button>
        <% }else{ %>
          <a href="/cancel_order/<%= orders[0]._id %>" id="cancelOrderBtn">
            <button class="btn btn-fill-out col-md-12 mb-4"> 
              <h4 style="color: red;">CANCEL ORDER</h4>
            </button></a> 
        <% } %>
        
        </section>

<div id="addressModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h4 class="text-center">VIEW DELIVERY ADDRESS</h4>
    <hr>
    <div class="form-group">
      <p>Full name </p>
      <input type="text" required="" name="name" value="<%= address.name %>" class="form-control" disabled>
    </div>
    
    <hr>
    
    <div class="form-group">
      <p>Address </p>
      <input type="text" name="address" required="" value="<%= address.address %>" class="form-control"disabled>
    </div>
    
    <div class="form-group">
      <p>City / Town </p>
      <input required="" type="text" name="city" value="<%= address.city %>" class="form-control"disabled>
    </div>
    
    <div class="form-group">
      <p>State / County </p>
      <input required="" type="text" name="state" value="<%= address.state %>" class="form-control"disabled>
    </div>
    
    <div class="form-group">
      <p>Postcode / ZIP </p>
      <input required="" type="text" name="zipcode" value="<%= address.zipcode %>" class="form-control"disabled>
    </div>
    
    <hr>
    
    <div class="form-group">
      <p>Phone </p>
      <input required="" type="text" name="phone" value="<%= address.phone %>" class="form-control"disabled>
    </div>
    
    <div class="form-group">
      <p>Email address </p>
      <input required="" type="email" name="email" value="<%= address.email %>" class="form-control"disabled>
    </div>
    
      <hr>
  </div>
  <hr>
</div> 


<script>
  var modal = document.getElementById("addressModal");
  var addressList = document.getElementById("addressList");

  // Function to open the modal
  function openModal() {
    modal.style.display = "block";
  }

  // Function to close the modal
  function closeModal() {
    modal.style.display = "none";
  }

</script>

<%-include('../partials/user_footer')%>
